// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 BigInt             @id @default(autoincrement())
  uid                String             @unique
  extId              String?            @unique @map("ext_id") // For SSO integration
  email              String             @unique
  name               String
  isBanned           Boolean            @default(false) @map("is_banned")
  profileUrl         String?            @map("profile_url")
  metadata           Json               @default("{}")
  mc                 MC? // Optional MC profile linkage
  studioMemberships  StudioMembership[]
  createdAt          DateTime           @default(now()) @map("created_at")
  updatedAt          DateTime           @updatedAt @map("updated_at")
  deletedAt          DateTime?          @map("deleted_at")

  @@index([uid])
  @@index([email])
  @@index([name])
  @@index([extId])
  @@index([isBanned])
  @@map("users")
}

model MC {
  id        BigInt    @id @default(autoincrement())
  uid       String    @unique
  userId    BigInt?   @unique @map("user_id")
  name      String
  aliasName String    @map("alias_name")
  isBanned  Boolean   @default(false) @map("is_banned")
  metadata  Json      @default("{}")
  showMCs   ShowMC[]
  user      User?     @relation(fields: [userId], references: [id])
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  @@index([uid])
  @@index([userId])
  @@index([name])
  @@index([aliasName])
  @@index([isBanned])
  @@map("mcs")
}

model Client {
  id            BigInt    @id @default(autoincrement())
  uid           String    @unique
  name          String    @unique
  contactPerson String    @map("contact_person")
  contactEmail  String    @map("contact_email")
  metadata      Json      @default("{}")
  shows         Show[]
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  deletedAt     DateTime? @map("deleted_at")

  @@index([uid])
  @@index([name])
  @@index([contactPerson])
  @@index([contactEmail])
  @@map("clients")
}

model Platform {
  id            BigInt         @id @default(autoincrement())
  uid           String         @unique
  name          String
  apiConfig     Json           @map("api_config")
  metadata      Json           @default("{}")
  showPlatforms ShowPlatform[]
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  deletedAt     DateTime?      @map("deleted_at")

  @@index([uid])
  @@index([name])
  @@map("platforms")
}

model Show {
  id             BigInt        @id @default(autoincrement())
  uid            String        @unique
  clientId       BigInt        @map("client_id")
  studioRoomId   BigInt        @map("studio_room_id")
  showTypeId     BigInt        @map("show_type_id")
  showStatusId   BigInt        @map("show_status_id")
  showStandardId BigInt        @map("show_standard_id")
  name           String
  startTime      DateTime      @map("start_time")
  endTime        DateTime      @map("end_time")
  metadata       Json          @default("{}")
  client         Client        @relation(fields: [clientId], references: [id])
  studioRoom     StudioRoom    @relation(fields: [studioRoomId], references: [id])
  showType       ShowType      @relation(fields: [showTypeId], references: [id])
  showStatus     ShowStatus    @relation(fields: [showStatusId], references: [id])
  showStandard   ShowStandard  @relation(fields: [showStandardId], references: [id])
  showMCs        ShowMC[]
  showPlatforms  ShowPlatform[]
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")
  deletedAt      DateTime?     @map("deleted_at")

  @@index([uid])
  @@index([name])
  @@index([clientId])
  @@index([studioRoomId])
  @@index([showTypeId])
  @@index([showStatusId])
  @@index([showStandardId])
  @@index([startTime, endTime])
  @@index([startTime])
  @@index([endTime])
  @@map("shows")
}

model ShowMC {
  id        BigInt    @id @default(autoincrement())
  uid       String    @unique
  showId    BigInt    @map("show_id")
  mcId      BigInt    @map("mc_id")
  note      String?
  metadata  Json      @default("{}")
  show      Show      @relation(fields: [showId], references: [id])
  mc        MC        @relation(fields: [mcId], references: [id])
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  @@unique([showId, mcId])
  @@index([uid])
  @@index([showId])
  @@index([mcId])
  @@map("show_mcs")
}

model ShowPlatform {
  id             BigInt    @id @default(autoincrement())
  uid            String    @unique
  showId         BigInt    @map("show_id")
  platformId     BigInt    @map("platform_id")
  liveStreamLink String    @map("live_stream_link")
  platformShowId String    @map("platform_show_id") // external id of the platform e.g., tiktok
  viewerCount    Int       @default(0) @map("viewer_count")
  metadata       Json      @default("{}")
  show           Show      @relation(fields: [showId], references: [id])
  platform       Platform  @relation(fields: [platformId], references: [id])
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")
  deletedAt      DateTime? @map("deleted_at")

  @@unique([showId, platformId])
  @@index([uid])
  @@index([showId])
  @@index([platformId])
  @@index([platformShowId])
  @@map("show_platforms")
}

model Studio {
  id                BigInt             @id @default(autoincrement())
  uid               String             @unique
  name              String
  address           String
  metadata          Json               @default("{}")
  studioRooms       StudioRoom[]
  studioMemberships StudioMembership[]
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @updatedAt @map("updated_at")
  deletedAt         DateTime?          @map("deleted_at")

  @@index([uid])
  @@index([name])
  @@map("studios")
}

model StudioRoom {
  id        BigInt    @id @default(autoincrement())
  uid       String    @unique
  studioId  BigInt    @map("studio_id")
  name      String
  capacity  Int
  metadata  Json      @default("{}")
  studio    Studio    @relation(fields: [studioId], references: [id])
  shows     Show[]
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  @@index([uid])
  @@index([studioId])
  @@index([name])
  @@index([studioId, name])
  @@map("studio_rooms")
}

model ShowType {
  id        BigInt    @id @default(autoincrement())
  uid       String    @unique
  name      String    @unique // bau, campaign, other
  metadata  Json      @default("{}")
  shows     Show[]
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  @@index([uid])
  @@map("show_types")
}

model ShowStatus {
  id        BigInt    @id @default(autoincrement())
  uid       String    @unique
  name      String    @unique // draft, confirmed, live, completed, cancelled
  metadata  Json      @default("{}")
  shows     Show[]
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  @@index([uid])
  @@map("show_status")
}

model ShowStandard {
  id        BigInt    @id @default(autoincrement())
  uid       String    @unique
  name      String    @unique // standard, premium
  metadata  Json      @default("{}")
  shows     Show[]
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  @@index([uid])
  @@map("show_standards")
}

model StudioMembership {
  id        BigInt    @id @default(autoincrement())
  uid       String    @unique
  userId    BigInt    @map("user_id")
  studioId  BigInt    @map("studio_id")
  role      String // admin, manager, member
  metadata  Json      @default("{}")
  user      User      @relation(fields: [userId], references: [id])
  studio    Studio    @relation(fields: [studioId], references: [id])
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  @@unique([userId, studioId])
  @@index([uid])
  @@index([userId])
  @@index([studioId])
  @@index([role])
  @@index([userId, role])
  @@map("studio_memberships")
}
